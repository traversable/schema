<br>
<h1 align="center">ᯓ𝘁𝗿𝗮𝘃𝗲𝗿𝘀𝗮𝗯𝗹𝗲/𝘁𝘆𝗽𝗲𝗯𝗼𝘅-𝘁𝗲𝘀𝘁</h1>
<br>

<p align="center">
  Testing utility that generates arbitrary, <a href="https://en.wikipedia.org/wiki/Pseudorandomness" target="_blank">pseudorandom</a> <a href="https://github.com/sinclairzx81/typebox" target="_blank">TypeBox</a> schemas, powered by <a href="https://github.com/dubzzz/fast-check" target="_blank"><code>fast-check</code></a>
</p>

<div align="center">
  <img alt="NPM Version" src="https://img.shields.io/npm/v/%40traversable%2Ftypebox-test?style=flat-square&logo=npm&label=npm&color=blue">
  &nbsp;
  <img alt="TypeScript" src="https://img.shields.io/badge/TypeScript-5.5%2B-blue?style=flat-square&logo=TypeScript&logoColor=4a9cf6">
  &nbsp;
  <img alt="License" src="https://img.shields.io/static/v1?label=Hippocratic%20License&message=HL3&labelColor=59636e&color=838a93">
  &nbsp;
  <img alt="npm" src="https://img.shields.io/npm/dt/@traversable/typebox-test?style=flat-square">
  &nbsp;
</div>
<br>
<br>

## Requirements

`@traversable/typebox-test` has 2 peer dependencies:

1. [`@sinclair/typebox`](https://github.com/sinclairzx81/typebox) (v0.34)
2. [`fast-check`](https://fast-check.dev/)

## Usage

```bash
$ pnpm add -D @traversable/typebox-test @sinclair/typebox fast-check
```

Here's an example of importing the library:

```typescript
import * as T from '@sinclair/typebox'
import { boxTest } from '@traversable/typebox-test'

// see below for specifc examples
```

## Table of contents

- [`boxTest.SeedGenerator`](https://github.com/traversable/schema/tree/main/packages/typebox-test#boxtestseedgenerator)
- [`boxTest.seedToSchema`](https://github.com/traversable/schema/tree/main/packages/typebox-test#boxtestseedtoschema)
- [`boxTest.seedToValidData`](https://github.com/traversable/schema/tree/main/packages/typebox-test#boxtestseedtovaliddata)
- [`boxTest.seedToInvalidData`](https://github.com/traversable/schema/tree/main/packages/typebox-test#boxtestseedtoinvaliddata)


### `boxTest.seedToSchema`

Use `boxTest.seedToSchema` to convert a seed generated by `boxTest.SeedGenerator` into a
TypeBox schema that satisfies the configuration options you specified.

#### Example

```typescript
import * as T from '@sinclair/typebox'
import { boxTest } from '@traversable/typebox-test'
import * as fc from 'fast-check'

const builder = boxTest.SeedGenerator()['*']
const [mySeed] = fc.sample(builder.object, 1)

const mySchema = boxTest.seedToSchema(mySeed)
//    ^? const mySchema: T.TSchema
```

### `boxTest.seedToValidData`

Use `boxTest.seedToValidData` to convert a seed generated by `boxTest.SeedGenerator` into
data that satisfies the schema that the seed represents.

#### Example

```typescript
import * as T from '@sinclair/typebox'
import * as Value from '@sinclair/typebox/value'
import { boxTest } from '@traversable/typebox-test'
import * as fc from 'fast-check'

const builder = boxTest.SeedGenerator()['*']
const [mySeed] = fc.sample(builder.object, 1)

const mySchema = boxTest.seedToSchema(mySeed)
//    ^? const mySchema: T.TSchema

const validData = boxTest.seedToValidData(mySeed)

Value.Check(mySchema, validData) // always `true`
```

### `boxTest.seedToInvalidData`

Use `boxTest.seedToInvalidData` to convert a seed generated by `boxTest.SeedGenerator` into
data that does **not** satisfy the schema that the seed represents.

#### Example

```typescript
import * as T from '@sinclair/typebox'
import * as Value from '@sinclair/typebox/value'
import { boxTest } from '@traversable/typebox-test'
import * as fc from 'fast-check'

const builder = boxTest.SeedGenerator()['*']
const [mySeed] = fc.sample(builder.object, 1)

const mySchema = boxTest.seedToSchema(mySeed)
//    ^? const mySchema: T.TSchema

const invalidData = boxTest.seedToValidData(mySeed)

Value.Check(mySchema, invalidData) // always `false`
```

### `boxTest.SeedGenerator`

Generates a configurable, pseudo-random "seed builder".

- Use [`boxTest.seedToSchema`](https://github.com/traversable/schema/tree/main/packages/typebox-test#boxtestseedtoschema) to convert a seed into a TypeBox schema
- Use [`boxTest.seedToValidData`](https://github.com/traversable/schema/tree/main/packages/typebox-test#boxtestseedtovaliddata) to convert a seed into valid data
- Use [`boxTest.seedToInvalidData`](https://github.com/traversable/schema/tree/main/packages/typebox-test#boxtestseedtoinvaliddata) to convert a seed into invalid data

#### Example

```typescript
import * as T from '@sinclair/typebox'
import { boxTest } from '@traversable/typebox-test'
import * as fc from 'fast-check'

const builder = boxTest.SeedGenerator({
  include: ["boolean", "string", "object"],
  // 𐙘 use `include` to only include certain schema types
  exclude: ["boolean", "any"],
  // 𐙘 use `exclude` to exclude certain schema types altogether (overrides `include`)
  minDepth: 1,
  // 𐙘 use `minDepth` to control the schema's minimum depth
  //   **NOTE:** schemas can get very large!
  //   using in your CI/CD pipeline is _not_ recommended
  object: { maxKeys: 5 },
  // 𐙘 specific arbitraries are configurable by name
})

// included schemas are present as properties on your generator...
builder.string
builder.object

// ...excluded schemas are not present...
builder.boolean // 🚫 TypeError

// ...a special wildcard `"*"` property (pronounced "surprise me") is always present:
builder["*"]

/**
 * `fast-check` will generate a seed, which is a data structure containing
 * integers that represent a kind of AST.
 *
 * To use a seed, you need to pass it to an interpreter like `boxTest.seedToSchema`,
 * `boxTest.seedToValidData` or `boxTest.seedToInvalidData`:
 */

const [mySeed] = fc.sample(builder.object, 1)

const mySchema = boxTest.seedToSchema(mySeed)
//    ^? const mySchema: T.TSchema

const validData = boxTest.seedToValidData(mySeed)
//    ^? since the `mySeed` was also used to generate `mySchema`,
//       parsing `validData` should always succeed

const invalidData = boxTest.seedToInvalidData(mySeed)
//    ^? since the `mySeed` was also used to generate `mySchema`,
//       parsing `invalidData` should always fail
```
