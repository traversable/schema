<br>
<h1 align="center">á¯“ğ˜ğ—¿ğ—®ğ˜ƒğ—²ğ—¿ğ˜€ğ—®ğ—¯ğ—¹ğ—²/ğ˜‡ğ—¼ğ—±-ğ˜ğ—²ğ˜€ğ˜</h1>
<br>

<p align="center">
  TODO: write me
</p>

<div align="center">
  <img alt="NPM Version" src="https://img.shields.io/npm/v/%40traversable%2Fzod-test?style=flat-square&logo=npm&label=npm&color=blue">
  &nbsp;
  <img alt="TypeScript" src="https://img.shields.io/badge/TypeScript-5.5%2B-blue?style=flat-square&logo=TypeScript&logoColor=4a9cf6">
  &nbsp;
  <img alt="Static Badge" src="https://img.shields.io/badge/license-MIT-a094a2?style=flat-square">
  &nbsp;
  <img alt="npm" src="https://img.shields.io/npm/dt/@traversable/zod-test?style=flat-square">
  &nbsp;
</div>

<div align="center">
  <!-- <img alt="npm bundle size (scoped)" src="https://img.shields.io/bundlephobia/minzip/%40traversable/zod-test?style=flat-square&label=size">
  &nbsp; -->
  <img alt="Static Badge" src="https://img.shields.io/badge/ESM-supported-2d9574?style=flat-square&logo=JavaScript">
  &nbsp;
  <img alt="Static Badge" src="https://img.shields.io/badge/CJS-supported-2d9574?style=flat-square&logo=Node.JS">
  &nbsp;
</div>

<div align="center">
  <a href="https://stackblitz.com/edit/traversable?file=src%2Fsandbox.tsx" target="_blank">Demo (StackBlitz)</a>
  <span>&nbsp;&nbsp;â€¢&nbsp;&nbsp;</span>
  <a href="https://tsplay.dev/w2y29W" target="_blank">TypeScript Playground</a>
  <span>&nbsp;&nbsp;â€¢&nbsp;&nbsp;</span>
  <a href="https://www.npmjs.com/package/@traversable/zod-test" target="_blank">npm</a>
  <br>
</div>
<br>
<br>


## Requirements

`@traversable/zod-test` has 2 peer dependencies:

1. [zod](https://zod.dev/) (v4, classic)
2. [fast-check](https://fast-check.dev/)

## Usage

```bash
$ pnpm add @traversable/zod-test zod fast-check
```

Here's an example of importing the library:

```typescript
import { z } from 'zod'
import { zxTest } from '@traversable/zod-test'

// see below for specifc examples
```

## Table of contents

- [`zx.SeedGenerator`](https://github.com/traversable/schema/tree/main/packages/zod#zxseedgenerator)
- [`zx.seedToSchema`](https://github.com/traversable/schema/tree/main/packages/zod#zxseedtoschema)
- [`zx.seedToValidData`](https://github.com/traversable/schema/tree/main/packages/zod#zxseedtovaliddata)
- [`zx.seedToInvalidData`](https://github.com/traversable/schema/tree/main/packages/zod#zxseedtoinvaliddata)


### `zxTest.seedToSchema`

Use `zxTest.seedToSchema` to convert a seed generated by `zxTest.SeedGenerator` into a
zod schema that satisfies the configuration options you specified.

#### Example

```typescript
import { zxTest } from '@traversable/zod-test'
import * as fc from 'fast-check'

const [mySeed] = fc.sample(builder.object, 1)

const builder = zxTest.SeedGenerator()['*']
const mySchema = zxTest.seedToSchema(mySeed)
//    ^? const mySchema: z.ZodType
```

### `zxTest.seedToValidData`

Use `zxTest.seedToValidData` to convert a seed generated by `zxTest.SeedGenerator` into
data that satisfies the schema that the seed represents.

#### Example

```typescript
import { zxTest } from '@traversable/zod-test'
import * as fc from 'fast-check'

const [mySeed] = fc.sample(builder.object, 1)

const builder = zxTest.SeedGenerator()['*']
const mySchema = zxTest.seedToSchema(mySeed)
//    ^? const mySchema: z.ZodType

const validData = zxTest.seedToValidData(mySeed)

mySchema.parse(validData) // will never throw
```

### `zxTest.seedToInvalidData`

Use `zxTest.seedToInvalidData` to convert a seed generated by `zxTest.SeedGenerator` into
data that does **not** satisfy the schema that the seed represents.

#### Example

```typescript
import { zxTest } from '@traversable/zod-test'
import * as fc from 'fast-check'

const [mySeed] = fc.sample(builder.object, 1)

const builder = zxTest.SeedGenerator()['*']
const mySchema = zxTest.seedToSchema(mySeed)
//    ^? const mySchema: z.ZodType

const invalidData = zxTest.seedToValidData(mySeed)

mySchema.parse(invalidData) // should always throw
```

### `zxTest.SeedGenerator`

Generates a configurable, pseudo-random "seed builder".

- Use [`zxTest.seedToSchema`](https://github.com/traversable/schema/tree/main/packages/zod#zxtestseedtoschema) to convert a seed into a zod schema
- Use [`zxTest.seedToValidData`](https://github.com/traversable/schema/tree/main/packages/zod#zxtestseedtovaliddata) to convert a seed into valid data
- Use [`zxTest.seedToInvalidData`](https://github.com/traversable/schema/tree/main/packages/zod#zxtestseedtoinvaliddata) to convert a seed into invalid data

#### Example

```typescript
import { z } from 'zod'
import { zxTest } from '@traversable/zod-test'
import * as fc from 'fast-check'

const builder = zxTest.SeedGenerator({
  include: ["boolean", "string", "object"],
  // ğ™˜ use `include` to only include certain schema types
  exclude: ["boolean", "any"],
  // ğ™˜ use `exclude` to exclude certain schema types altogether (overrides `include`)
  minDepth: 1,
  // ğ™˜ use `minDepth` to control the schema's minimum depth
  //   **NOTE:** schemas can get very large!
  //   using in your CI/CD pipeline is _not_ recommended
  object: { maxKeys: 5 },
  // ğ™˜ specific arbitraries are configurable by name
})

// included schemas are present as properties on your generator...
builder.string
builder.object

// ...excluded schemas are not present...
builder.boolean

// ...a special wildcard `"*"` property (pronounced "surprise me") is always present:
builder["*"]

/**
 * A "b" is a `fast-check` arbitrary.
 *
 * `fast-check` will generate a seed, which is a data structure containing
 * integers that represent a kind of AST.
 *
 * To use a seed, you need to pass it to an interpreter like `zxTest.seedToSchema`,
 * `zxTest.seedToValidData` or `zxTest.seedToInvalidData`:
 */

const [mySeed] = fc.sample(builder.object, 1)

const mySchema = zxTest.seedToSchema(mySeed)
//    ^? const mySchema: z.ZodType

const validData = zxTest.seedToValidData(mySeed)
//    ^? since the `mySeed` was also used to generate `mySchema`,
//       parsing `validData` should always succeed

const invalidData = zxTest.seedToInvalidData(mySeed)
//    ^? since the `mySeed` was also used to generate `mySchema`,
//       parsing `invalidData` should always fail
```

#### Track record

`zxTest.SeedGenerator` has found several upstream bugs in `zod/core`:

1. Bug: `z.object` prototype pollution bug
  - [Issue](https://github.com/colinhacks/zod/issues/4357)
  - [Sandbox](https://stackblitz.com/edit/vitest-dev-vitest-ypelnmjv?file=test%2Fbasic.test.ts)

2. Bug: `z.literal` escaping bug
  - [Issue](https://github.com/colinhacks/zod/issues/4894)
  - [Sandbox](https://stackblitz.com/edit/vitest-dev-vitest-w1um2qny?file=test%2Frepro.test.ts)
